(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{l:()=>z,s:()=>H});var t=document.querySelector(".profile__avatar-image"),n=document.querySelector(".profile__name"),r=document.querySelector(".profile__description"),o=document.querySelector(".popup_type_profile-edit"),c=o.querySelector(".profile-edit-form__close-icon"),i=o.querySelector(".name-input"),a=o.querySelector(".description-input"),u=o.querySelector(".profile-edit-form__submit-btn"),l=o.querySelector(".profile-edit-form"),s=document.querySelector(".popup_type_add-card"),d=document.querySelector(".places-grid"),p=document.querySelector(".card-template"),f=s.querySelector(".profile-edit-form"),m=s.querySelector(".name-input"),_=s.querySelector(".description-input"),v=s.querySelector(".profile-edit-form__submit-btn"),h=s.querySelector(".profile-edit-form__close-icon"),y=document.querySelector(".popup_type_profile-image-edit"),S=y.querySelector(".profile-edit-form__close-icon"),b=y.querySelector(".profile-edit-form"),q=y.querySelector(".description-input"),g=y.querySelector(".profile-edit-form__submit-btn"),E=document.querySelector(".popup_type_image"),L=E.querySelector(".popup-image__picture"),k=E.querySelector(".popup-image__title"),C=E.querySelector(".profile-edit-form__close-icon");function x(e,t,n){e.querySelector("#error-"+t.id).textContent="",t.classList.remove(n.inputErrorClass)}function U(e,t){e.checkValidity()?t.disabled=!1:t.disabled=!0}var T={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-7",headers:{authorization:"50b7264a-788e-45f0-906b-12b3c772c60f","Content-Type":"application/json"}};function P(e){return e.ok?e.json():e.json().then((function(t){return t.statusCode=e.status,Promise.reject(t)}))}var w,O=document.querySelector(".error-shower");function j(e){O.textContent=e,O.classList.add("popup_opened"),clearTimeout(w),w=setTimeout((function(){O.classList.remove("popup_opened")}),5e3)}var A="5e0293eca320251cc7a22ed7";function D(e){var t=p.content.cloneNode(".places-grid__card"),n=t.querySelector(".place__image"),r=t.querySelector(".place__delete-btn"),o=t.querySelector(".place__like-btn"),c=t.querySelector(".place__like-counter");function i(e){return e.includes(A)}return n.src=e.link,e.alt?n.alt=e.alt:n.alt=e.name,t.querySelector(".place__name").textContent=e.name,c.textContent=e.likes.length,o.likes=e.likes.map((function(e){return e._id})),i(o.likes)&&o.classList.toggle("place__like-btn_active"),o.addEventListener("click",(function(t){function n(e){t.target.likes=e.likes.map((function(e){return e._id})),t.target.classList.toggle("place__like-btn_active"),c.textContent=t.target.likes.length}var r;i(t.target.likes)?(r=e._id,fetch("".concat(T.baseUrl,"/cards/likes/").concat(r),{headers:T.headers,method:"DELETE"}).then(P)).then(n).catch((function(e){return j(e.message)})):function(e){return fetch("".concat(T.baseUrl,"/cards/likes/").concat(e),{headers:T.headers,method:"PUT"}).then(P)}(e._id).then(n).catch((function(e){return j(e.message)}))})),e.owner._id!==A?r.remove():r.addEventListener("click",(function(t){var n;(n=e._id,fetch("".concat(T.baseUrl,"/cards/").concat(n),{headers:T.headers,method:"DELETE"}).then(P)).then(t.target.closest(".places-grid__card").remove()).catch((function(e){j(e.message)}))})),t.querySelector(".place__image-btn").addEventListener("click",(function(){L.src=n.src,L.alt=n.alt,k.textContent=e.name,N(E)})),t}function N(e){e.classList.add("popup_opened"),document.addEventListener("keydown",F)}function J(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",F)}function F(e){"Escape"===e.key&&(o.classList.contains("popup_opened")?J(o):s.classList.contains("popup_opened")?J(s):E.classList.contains("popup_opened")?J(E):y.classList.contains("popup_opened")&&J(y))}function H(e){e.name&&(n.textContent=e.name),e.about&&(r.textContent=e.about),e.avatar&&(t.src="".concat(e.avatar))}function z(){i.value=n.textContent,a.value=r.textContent}Promise.all([fetch("".concat(T.baseUrl,"/users/me"),{headers:T.headers}).then(P).then((function(e){H(e)})),fetch("".concat(T.baseUrl,"/cards"),{headers:T.headers}).then(P).then((function(e){e.reverse().forEach((function(e){return d.prepend(D(e))}))}))]).catch((function(e){j(e.message)})),C.addEventListener("click",(function(){return J(E)})),f.addEventListener("submit",(function(e){var t;e.preventDefault(),v.value="Сохранение...",(t={name:m.value,link:_.value},fetch("".concat(T.baseUrl,"/cards"),{headers:T.headers,method:"POST",body:JSON.stringify(t)}).then(P)).then((function(e){d.prepend(D(e)),v.value="Создать",f.reset(),U(f,v),J(s)})).catch((function(e){j(e.message),v.value="Создать"}))})),h.addEventListener("click",(function(){return J(s)})),document.querySelector(".profile__add-btn").addEventListener("click",(function(){return N(s)})),l.addEventListener("submit",(function(e){var t;e.preventDefault(),u.value="Сохранение...",(t={name:i.value,about:a.value},fetch("".concat(T.baseUrl,"/users/me"),{headers:T.headers,method:"PATCH",body:JSON.stringify(t)}).then(P)).then((function(e){H(e),u.value="Сохранить",J(o)})).catch((function(e){u.value="Сохранить",j(e.message)}))})),c.addEventListener("click",(function(){return J(o)})),document.querySelector(".profile__edit-btn").addEventListener("click",(function(){z(),l.querySelectorAll(".profile-edit-form__input").forEach((function(e){x(l,e,{inputErrorClass:"profile-edit-form__input_invalid"})})),U(l,u),N(o)})),b.addEventListener("submit",(function(e){var t;e.preventDefault(),g.value="Сохранение...",(t={avatar:q.value},fetch("".concat(T.baseUrl,"/users/me/avatar"),{headers:T.headers,method:"PATCH",body:JSON.stringify(t)}).then(P)).then((function(e){H(e),g.value="Сохранить",b.reset(),J(y)})).catch((function(e){j(e.message),g.value="Сохранить"}))})),S.addEventListener("click",(function(){return J(y)})),document.querySelector(".profile__avatar-btn").addEventListener("click",(function(){return N(y)})),[s,o,E,y].forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&J(e)}))})),function(e){document.querySelectorAll(e.formSelector).forEach((function(t){!function(e,t){var n=e.querySelectorAll(t.inputFieldSelector),r=e.querySelector(t.buttonSubmitSelector);U(e,r),n.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?x(e,t,n):function(e,t,n,r){e.querySelector("#error-"+t.id).textContent=n,t.classList.add(r.inputErrorClass)}(e,t,t.validationMessage,n)}(e,n,t),U(e,r)}))}))}(t,e)}))}({formSelector:".profile-edit-form",inputFieldSelector:".profile-edit-form__input",buttonSubmitSelector:".profile-edit-form__submit-btn",inputErrorClass:"profile-edit-form__input_invalid"})})();